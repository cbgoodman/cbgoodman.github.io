<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,partials=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1 minimal-ui">

<meta name="description" content="">
<meta name="keywords" content="">




<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@cbgoodman">
<meta name="twitter:title" content="Maps in R using urbnmapr : cgoodman.com">
<meta name="twitter:creator" content="@cbgoodman">
<meta name="twitter:description" content="">
<meta name="twitter:image:src" content="">
<meta name="twitter:domain" content="cgoodman.com">


    <base href="https://www.cgoodman.com/">
    <title> Maps in R using urbnmapr </title>
    <link rel="canonical" href="https://www.cgoodman.com/blog/archives/2018/06/16/maps-in-r-using-urbnmapr/">
    

    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-X6T9KJM7FQ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-X6T9KJM7FQ');
    </script>

        <link rel="me" href="https://sciences.social/@cbgoodman" />
        <link rel="stylesheet" type="text/css" href="https://www.cgoodman.com/css/kube.css"  />
        <link rel="stylesheet" type="text/css" href="https://www.cgoodman.com/css/demo.css"  />
	      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

        











        
<script type="text/javascript" src="https://use.typekit.com/kpn7wwu.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>


    <link rel="shortcut icon" href="https://www.cgoodman.com/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="https://www.cgoodman.com/apple-touch-icon.png" />
    
</head>


<body>
<div id="topbar">
<div class="wrapper">
  <header>
  <nav class="navbar">
  <ul>
    <li><strong><a href="https://www.cgoodman.com/">Christopher B. Goodman</a></strong></li>
    
    
    <li><span> <a class="" href="https://www.cgoodman.com/cv">Bio &amp; CV </a></span>
      
    <li><span> <a class="" href="https://www.cgoodman.com/research">Research </a></span>
      
    <li><span> <a class="" href="https://www.cgoodman.com/data">Data </a></span>
      
    <li><span> <a class="" href="https://www.cgoodman.com/teaching">Teaching </a></span>
      
    <li><span> <a class="" href="https://www.cgoodman.com/blog">Blog </a></span>
      
  </ul>
</nav>

  </header>
</div>
</div>

<div class="wrapper">
<div class="units-row">
<div class="unit-20">&nbsp;</div>
<div class="unit-60"><h2><a href="">Maps in R using urbnmapr</a></h2></div>
</div>
<div class="units-row">
  <div class="unit-20 dateblock"><h4>June 16, 2018</h4>


    
    &middot; <a class="small" href="https://www.cgoodman.com/categories/r">R</a>
    
    &middot; <a class="small" href="https://www.cgoodman.com/categories/dataviz">dataviz</a>
    
    &middot; <a class="small" href="https://www.cgoodman.com/categories/maps">maps</a>
    


  </div>
<div class="unit-60">

  <p>The Urban Institute has released a new package for mapping state and county data in <strong>R</strong>, <code>urbnmapr</code>. Their posts can be found <a href="https://medium.com/@urban_institute/how-to-create-state-and-county-maps-easily-in-r-577d29300bb2">here</a> and
<a href="https://ui-research.github.io/r-at-urban/mapping.html">here</a>. Since I occasionally write about how to make simple maps in <strong>R</strong>, I am going to quickly go from start to finish on making a county map.</p>
<h2 id="installation">Installation</h2>
<p>Installation is easy. The library is hosted on Urban&rsquo;s <a href="https://github.com/UrbanInstitute/urbnmapr">GitHub</a> page. Installing <strong>R</strong> packages from non-CRAN sources requires the <code>devtools</code> package.</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#268bd2">require</span>(<span style="color:#2aa198">&#34;devtools&#34;</span>)
devtools<span style="color:#719e07">::</span><span style="color:#268bd2">install_github</span>(“UrbanInstitute<span style="color:#719e07">/</span>urbnmapr”)
</code></pre></div><h2 id="example">Example</h2>
<p>Let&rsquo;s dive into any example. Since my last <a href="https://www.cgoodman.com/2017/02/14/maps-in-library%28maps%29-updated/">Maps in R</a> post used data on the <a href="http://www.metrostudies.pitt.edu/Projects/Metropolitan-Power-Diffusion-Index">Metropolitan Power Diffusion Index</a> for special districts from year 2012, we&rsquo;ll use the same data. The base data comes from the <a href="http://www.census.gov/govs/cog/">2012 Census of Governments</a></p>
<p><code>urbnmapr</code> is a package to map states and/or counties in <code>ggplot2</code> so for simplicity sake, we&rsquo;ll load the entire <code>tidyverse</code> library. We&rsquo;ll need to load <code>dplyr</code> for the join anyways. I have loaded the <code>viridis</code> library to gain access to the <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html">Viridis color scale</a>. This isn&rsquo;t necessary, but I like the color options.</p>
<p>To add the MPDI data to the <code>urbnmapr</code> data, <code>left_join()</code> from the <code>dplyr</code> package is used. One thing to pay close attention to is this requires the joining data to be of the same class. <code>county_fips</code> in <code>urbnmapr::counties</code> is of class character; hence, my import of the county FIPS variable as &ldquo;character&rdquo;.</p>
<!---required packages and data import--->
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#268bd2">library</span>(<span style="color:#2aa198">&#34;tidyverse&#34;</span>)
<span style="color:#268bd2">library</span>(<span style="color:#2aa198">&#34;viridis&#34;</span>)
<span style="color:#268bd2">library</span>(<span style="color:#2aa198">&#34;urbnmapr&#34;</span>)

<span style="color:#586e75"># Add data</span>
mpdi <span style="color:#719e07">&lt;-</span> <span style="color:#268bd2">read.csv</span>(<span style="color:#2aa198">&#34;mpdi.csv&#34;</span>, header<span style="color:#719e07">=</span><span style="color:#cb4b16">TRUE</span>, sep<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;,&#34;</span>,
        quote<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;\&#34;&#34;</span>, colClass<span style="color:#719e07">=</span><span style="color:#268bd2">c</span>(<span style="color:#2aa198">&#34;character&#34;</span>, <span style="color:#2aa198">&#34;numeric&#34;</span>))
<span style="color:#586e75"># Join with urbnmapr</span>
mpdi.data <span style="color:#719e07">&lt;-</span> <span style="color:#268bd2">left_join</span>(mpdi, counties, by <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;county_fips&#34;</span>)
</code></pre></div><p>With the data imported and joined, I next define some cut points in the data. This step isn&rsquo;t strictly necessary depending on your data (<code>ggplot2</code> will attempt to map any numerical data on a continuous scale). For these data, defining some cut points makes for a more meaningful map.</p>
<!---create quantiles--->
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#586e75"># Create quantiles</span>
no_classes <span style="color:#719e07">&lt;-</span> <span style="color:#2aa198">6</span>
labels <span style="color:#719e07">&lt;-</span> <span style="color:#268bd2">c</span>()
quantiles <span style="color:#719e07">&lt;-</span> <span style="color:#268bd2">quantile</span>(mpdi.data<span style="color:#719e07">$</span>mpdi,
                      probs <span style="color:#719e07">=</span> <span style="color:#268bd2">seq</span>(<span style="color:#2aa198">0</span>, <span style="color:#2aa198">1</span>, length.out <span style="color:#719e07">=</span> no_classes <span style="color:#719e07">+</span> <span style="color:#2aa198">1</span>))
<span style="color:#586e75"># Custom labels, rounding</span>
labels <span style="color:#719e07">&lt;-</span> <span style="color:#268bd2">c</span>()
<span style="color:#268bd2">for</span>(idx in <span style="color:#2aa198">1</span><span style="color:#719e07">:</span><span style="color:#268bd2">length</span>(quantiles)){
  labels <span style="color:#719e07">&lt;-</span> <span style="color:#268bd2">c</span>(labels, <span style="color:#268bd2">paste0</span>(<span style="color:#268bd2">round</span>(quantiles[idx], <span style="color:#2aa198">2</span>),
  <span style="color:#2aa198">&#34; – &#34;</span>,
  <span style="color:#268bd2">round</span>(quantiles[idx <span style="color:#719e07">+</span> <span style="color:#2aa198">1</span>], <span style="color:#2aa198">2</span>)))
}
<span style="color:#586e75"># Minus one label to remove the odd ending one</span>
labels <span style="color:#719e07">&lt;-</span> labels[1<span style="color:#719e07">:</span><span style="color:#268bd2">length</span>(labels)<span style="color:#2aa198">-1</span>]

<span style="color:#586e75"># Create new variable for fill</span>
mpdi.data<span style="color:#719e07">$</span>mpdi.quantiles <span style="color:#719e07">&lt;-</span> <span style="color:#268bd2">cut</span>(mpdi.data<span style="color:#719e07">$</span>mpdi,
  breaks <span style="color:#719e07">=</span> quantiles,
  labels <span style="color:#719e07">=</span> labels,
  include.lowest <span style="color:#719e07">=</span> <span style="color:#268bd2">T</span>)
</code></pre></div><p>From here, we plot! If you&rsquo;re at all familiar with <code>ggplot2</code>, this should look very familiar. The two <code>geom_polygon</code> lines define the filled county map and the state outline map. <code>coord_map()</code> defines the map projection. Urban&rsquo;s post uses the Albers projection, but I happen to like the polyconic projection and that&rsquo;s what is used here. <code>coord_map()</code> can use any projection in the <code>mapproj</code> package so the choice of projection is up to you. <code>scale_fill_viridis()</code> uses the <code>virdis</code> library to assign colors. I have reversed the usual color scale and trimmed off the top color (<code>end=0.9</code>, bright yellow). The remainder of the code is theming. I remove all the axis labels and coloring, change the default font, and move the legend around.</p>
<!---plot!--->
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#268bd2">ggplot</span>() <span style="color:#719e07">+</span>
  <span style="color:#586e75"># County map</span>
  <span style="color:#268bd2">geom_polygon</span>(data <span style="color:#719e07">=</span> mpdi.data,
    mapping <span style="color:#719e07">=</span> <span style="color:#268bd2">aes</span>(x <span style="color:#719e07">=</span> long, y <span style="color:#719e07">=</span> lat,
      group <span style="color:#719e07">=</span> group,
      fill <span style="color:#719e07">=</span> mpdi.data<span style="color:#719e07">$</span>mpdi.quantiles)) <span style="color:#719e07">+</span>
  <span style="color:#586e75"># Add state outlines</span>
  <span style="color:#268bd2">geom_polygon</span>(data <span style="color:#719e07">=</span> urbnmapr<span style="color:#719e07">::</span>states,
    mapping <span style="color:#719e07">=</span> <span style="color:#268bd2">aes</span>(long, lat,group <span style="color:#719e07">=</span> group),
    fill <span style="color:#719e07">=</span> <span style="color:#cb4b16">NA</span>, color <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;#ffffff&#34;</span>, size <span style="color:#719e07">=</span> <span style="color:#2aa198">0.4</span>) <span style="color:#719e07">+</span>
  <span style="color:#586e75"># Projection</span>
  <span style="color:#268bd2">coord_map</span>(projection <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;polyconic&#34;</span>)<span style="color:#719e07">+</span>
  <span style="color:#586e75"># Fill color</span>
  <span style="color:#268bd2">scale_fill_viridis</span>(
    option <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;viridis&#34;</span>,
    name <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;Metropolitan Power Diffusion Index&#34;</span>,
    discrete <span style="color:#719e07">=</span> <span style="color:#268bd2">T</span>,
    direction <span style="color:#719e07">=</span> <span style="color:#2aa198">-1</span>,
    end<span style="color:#719e07">=</span><span style="color:#2aa198">0.9</span>,
    guide <span style="color:#719e07">=</span> <span style="color:#268bd2">guide_legend</span>(
      keyheight <span style="color:#719e07">=</span> <span style="color:#268bd2">unit</span>(<span style="color:#2aa198">5</span>, units <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;mm&#34;</span>),
      title.position <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;top&#39;</span>,
      reverse <span style="color:#719e07">=</span> <span style="color:#268bd2">F</span>)
    )<span style="color:#719e07">+</span>
  <span style="color:#586e75"># Theming</span>
  <span style="color:#268bd2">theme_minimal</span>(base_family <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;Open Sans Condensed Light&#34;</span>)<span style="color:#719e07">+</span>
  <span style="color:#268bd2">theme</span>(
    legend.position <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;bottom&#34;</span>,
    legend.text.align <span style="color:#719e07">=</span> <span style="color:#2aa198">0</span>,
    plot.margin <span style="color:#719e07">=</span> <span style="color:#268bd2">unit</span>(<span style="color:#268bd2">c</span>(<span style="color:#2aa198">.5</span>,<span style="color:#2aa198">.5</span>,<span style="color:#2aa198">.2</span>,<span style="color:#2aa198">.5</span>), <span style="color:#2aa198">&#34;cm&#34;</span>)) <span style="color:#719e07">+</span>
  <span style="color:#268bd2">theme</span>(
    axis.line <span style="color:#719e07">=</span> <span style="color:#268bd2">element_blank</span>(),
    axis.text.x <span style="color:#719e07">=</span> <span style="color:#268bd2">element_blank</span>(),
    axis.text.y <span style="color:#719e07">=</span> <span style="color:#268bd2">element_blank</span>(),
    axis.ticks <span style="color:#719e07">=</span> <span style="color:#268bd2">element_blank</span>(),
    axis.title.x <span style="color:#719e07">=</span> <span style="color:#268bd2">element_blank</span>(),
    axis.title.y <span style="color:#719e07">=</span> <span style="color:#268bd2">element_blank</span>(),
    panel.grid.major <span style="color:#719e07">=</span> <span style="color:#268bd2">element_blank</span>(),
    panel.grid.minor <span style="color:#719e07">=</span> <span style="color:#268bd2">element_blank</span>(),
    )<span style="color:#719e07">+</span>
  <span style="color:#268bd2">theme</span>(plot.title<span style="color:#719e07">=</span><span style="color:#268bd2">element_text</span>(family<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;Open Sans Condensed Bold&#34;</span>, margin<span style="color:#719e07">=</span><span style="color:#268bd2">margin</span>(b<span style="color:#719e07">=</span><span style="color:#2aa198">15</span>)))<span style="color:#719e07">+</span>
  <span style="color:#268bd2">theme</span>(plot.subtitle<span style="color:#719e07">=</span><span style="color:#268bd2">element_text</span>(family<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;Open Sans Condensed Light Italic&#34;</span>))<span style="color:#719e07">+</span>
  <span style="color:#268bd2">theme</span>(plot.margin<span style="color:#719e07">=</span><span style="color:#268bd2">unit</span>(<span style="color:#268bd2">rep</span>(<span style="color:#2aa198">0.5</span>, <span style="color:#2aa198">4</span>), <span style="color:#2aa198">&#34;cm&#34;</span>))<span style="color:#719e07">+</span>
  <span style="color:#268bd2">labs</span>(x <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;&#34;</span>,
       y <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;&#34;</span>,
       title <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;Example map using the Data@Urban `urbnmapr&#39;&#34;</span>,
       subtitle <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;Metropolitan Power Diffusion Index, Special Districts 2012&#34;</span>,
       caption <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;Author: Chris Goodman (@cbgoodman), Data: U.S. Census Bureau Census of Governments&#34;</span>)
</code></pre></div><h2 id="final-product">Final Product</h2>
<p>The final product is sharp looking. Certainly web-ready and with a little more work is likely print-ready. As I move all my graphics production to <code>ggplot2</code>, <code>urbnmapr</code> is my new go-to for simple state or county mapping. It won&rsquo;t replace more complex operations requiring shapefiles, but it will reduce the amount of time and effort it takes to make simple maps.</p>
<figure><img src="files/misc/mpdi_urbnmapr.png"
         alt="Metropolitan Power Diffusion Index, 2012. Normally, Alaska would be included, but the original MPDI data file did not and I did not update it."/><figcaption>
            <p>Metropolitan Power Diffusion Index, 2012. Normally, Alaska would be included, but the original MPDI data file did not and I did not update it.</p>
        </figcaption>
</figure>


  

<ul class="pagination">
  
  <li><a href="https://www.cgoodman.com/blog/archives/2018/04/18/teaching-public-finance-with-john-oliver/">&laquo; <em>Previous</em> Teaching Public Finance with John Oliver</a></li>  
  
  <li><a href="https://www.cgoodman.com/blog/archives/2018/06/21/countyfips/">&raquo; <em>Next</em> countyfips</a></li>
</ul> 

<meta itemprop="wordCount" content="762">
<meta itemprop="datePublished" content="2018-06-16">
<meta itemprop="url" content="https://www.cgoodman.com/blog/archives/2018/06/16/maps-in-r-using-urbnmapr/">



        <a href="https://www.cgoodman.com/categories/">All Categories</a>


  
<div>





<p><a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.cgoodman.com%2fblog%2farchives%2f2018%2f06%2f16%2fmaps-in-r-using-urbnmapr%2f" target="_blank" aria-label="Facebook">
  <div class="badge-facebook"><i class="fab fa-facebook-f"></i> &nbsp; Share on Facebook</div>
</a>
</p>
<p>
<a href="https://twitter.com/intent/tweet/?text=Maps%20in%20R%20using%20urbnmapr; https%3a%2f%2fwww.cgoodman.com%2fblog%2farchives%2f2018%2f06%2f16%2fmaps-in-r-using-urbnmapr%2f" target="_blank" aria-label="Twitter">
  <div class="badge-twitter "><i class = "fab fa-twitter"></i>&nbsp; Share on Twitter</div>
</a>
</p>
</div>


</div>

</div>

</div>


<hr class="separator">

<div class="wrapper" style="font-size: 0.9em; line-height: 1.05em;">
  <div class="units-row units-padding">
    <div class="unit-40">
      <h3><a href="https://www.cgoodman.com/cv/">About</a></h3>
      <p>I teach about <a href="http://mpa.niu.edu/">public administration and local government</a> at <a href="http://www.niu.edu">Northern Illinois University</a>. <a href="cv/">Learn more</a>.</p>
    </div>
    <div class="unit-30">
      <h3>Where</h3>
      <ul class="compact fa-ul">
        <li><i class="fa-li fas fa-university" style="color:#03396c;font-size:80%;"></i>Department of Public Administration, Northern Illinois University, IA 204, DeKalb, Illinois 60115.</li>
        <li><i class="fa-li fas fa-envelope" style="color:#03396c;font-size:80%;padding-top:2px;"></i><a href="mailto:cbgoodman@niu.edu">cgoodman@niu.edu</a></li>
        <li><i class="fa-li fab fa-twitter-square fa-fw" style="color:#03396c;font-size:80%;padding-top:2px;"></i><a href="http://twitter.com/cbgoodman">@cbgoodman</a> on Twitter.</li>
		<li><i class="fa-li fab fa-mastodon" style="color:#03396c;font-size:80%;padding-top:2px;"></i><a rel="me" href="https://sciences.social/@cbgoodman">@cbgoodman</a> on Mastodon.</li>
        <li><i class="fa-li fab fa-github" style="color:#03396c;font-size:80%;padding-top:2px;"></i><a href="http://github.com/cbgoodman">On GitHub</a>.</li>
        <li><i class=""></li>
      </ul>
    </div>
<div class="unit-30">
				<h3>Subscribe</h3>
				<p>To receive updates from this site, you can
				subscribe to the <a href="https://www.cgoodman.com/index.xml"><i class="fas fa-rss-square" style="color:#03396c;"></i>&nbsp;RSS feed</a> of all updates to the site in an RSS feed reader</p>
				<h3>Search</h3>
				<a id="searchsite">
					<form method="get" action="https://duckduckgo.com/">
				<input type="search" name="q" maxlength="255" placeholder="Search the site">
			<input type="hidden" name="sites" value="www.cgoodman.com"/>
			   <input type="hidden" name="k7" value="#faf8f8"/>
			   <input type="hidden" name="kj" value="#b33"/>
			   <input type="hidden" name="ky" value="#fafafa"/>
			   <input type="hidden" name="kx" value="b"/>
			   <input type="hidden" name="ko" value="-1"/>
			   <input type="hidden" name="k1" value="-1"/>
			   <input type="submit" value="DuckDuckGo Search" style="visibility: hidden;" /></form></a>
			</div>
		</div>
	</div>
</div>


<footer id="footer">
<section class="wrapper small">Powered by <a href="http://gohugo.io">Hugo</a> and <a href="http://imperavi.com/kube/">Kube</a>. &copy; Christopher B. Goodman 2023.
</section>
</footer>

</body>
</html>
